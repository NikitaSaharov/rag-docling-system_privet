#!/bin/bash
# –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö markdown —Ñ–∞–π–ª–æ–≤

echo "============================================================"
echo "üîÑ –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è markdown —Ñ–∞–π–ª–æ–≤ (chunk_size=350, overlap=70)"
echo "============================================================"

files=(
    "/shared/processed/–ü–ò–†—ã ‚Ññ1,‚Ññ2,‚Ññ3_07.07.2025_–≥–æ—Ç–æ–≤–æ.md"
    "/shared/processed/–ü–ò–†—ã ‚Ññ10 –∏ –°–£_09.07.2025_–≥–æ—Ç–æ–≤–æ.md"
    "/shared/processed/–ü–ò–†—ã ‚Ññ4,‚Ññ5,‚Ññ6_09.07.2025_–≥–æ—Ç–æ–≤–æ.md"
    "/shared/processed/–ü–ò–†—ã ‚Ññ7,‚Ññ8,‚Ññ9_08.07.2025_–≥–æ—Ç–æ–≤–æ.md"
)

total=${#files[@]}
current=0

for md_file in "${files[@]}"; do
    current=$((current + 1))
    filename=$(basename "$md_file")
    
    echo ""
    echo "============================================================"
    echo "üìÑ [$current/$total] –û–±—Ä–∞–±–æ—Ç–∫–∞: $filename"
    echo "============================================================"
    
    echo ""
    echo "üî¢ –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ (chunk_size=350, overlap=70)..."
    python /app/create_embeddings.py "$md_file"
    
    if [ $? -eq 0 ]; then
        echo "   ‚úÖ –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    else
        echo "   ‚ùå –û—à–∏–±–∫–∞!"
    fi
done

echo ""
echo "============================================================"
echo "‚ú® –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "============================================================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤..."
python -c "import requests; r = requests.get('http://qdrant-docling:6333/collections/documents'); print(f'‚úÖ –í—Å–µ–≥–æ –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ –±–∞–∑–µ: {r.json()[\"result\"][\"points_count\"]}')" 2>/dev/null || echo "   ‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å"
